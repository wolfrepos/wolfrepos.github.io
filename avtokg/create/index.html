<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="../../css/main.css" />
  </head>
  <body>
    <div>
      <form>
        <select id="brand" name="brand"></select>
        <select id="model" name="model" disabled></select>
        <select id="year" name="year"></select>
        <label for="transmission">Трансмиссия</label>
        <div class="button-group">
          <button type="button" class="button button-pressed" id="today">
            Любая
          </button>
          <button type="button" class="button button-default" id="today">
            Механика
          </button>
          <button type="button" class="button button-default" id="this_week">
            Автомат
          </button>
          <button type="button" class="button button-default" id="this_month">
            Вариатор
          </button>
          <button type="button" class="button button-default" id="custom">
            Робот
          </button>
        </div>

        <label for="price">Цена в $</label>
        <input type="number" id="price" name="price" placeholder="Цена" />

        <label for="text">Описание</label>
        <textarea
          id="text"
          name="text"
          placeholder="Описание"
          rows="5"
        ></textarea>
      </form>
    </div>
  </body>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="../../js/dropDowns.js"></script>
  <script>
    $(document).ready(function () {
      function collectData() {
        const data = {
          brand: $("#brand").val(),
          model: $("#model").val(),
          year: $("#year").val(),
          price: parseInt($("#price").val(), 10),
          text: $("#text").val(),
        };
        if (
          data.brand !== "any" &&
          data.model &&
          data.model !== "any" &&
          data.year !== "any" &&
          data.price
        ) {
          enableSubmit(true);
        } else {
          enableSubmit(false);
        }
        return data;
      }
      $("#brand").on("change", collectData);
      $("#model").on("change", collectData);
      $("#price").on("input", collectData);
      $("#year").on("change", collectData);
      $("#text").on("change", collectData);

      const mainButton = window.Telegram.WebApp.MainButton;
      mainButton.text = "Опубликовать";
      mainButton.enable();
      mainButton.onClick(function () {
        window.Telegram.WebApp.sendData(JSON.stringify(collectData()));
      });

      function enableSubmit(activate) {
        if (activate) {
          mainButton.show();
        } else {
          mainButton.hide();
        }
      }
    });
    $(".button-group").on("click", ".button", function () {
      $(this)
        .addClass("button-pressed")
        .siblings()
        .removeClass("button-pressed")
        .addClass("button-default");
    });
  </script>
</html>

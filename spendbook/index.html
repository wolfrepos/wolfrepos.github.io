<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="../css/main.css" />
</head>

<body>
    <div>
        <form>
            <select id="category" name="category"></select>
            <label for="amount">Стоимость покупки в сомах</label>
            <input type="number" id="amount" name="amount" placeholder="Сом" />
            <textarea id="text" name="text" placeholder="Комментарий" rows="5"></textarea>
        </form>
    </div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="js/dropDowns.js"></script>
<script>
    $(document).ready(function () {
        function collectData() {
            const data = {
                category: $("#category").val(),
                amount: parseInt($("#amount").val(), 10),
                description: $("#text").val(),
            };
            Object.keys(data).forEach(
                (key) =>
                (data[key] =
                    data[key] === "any" || data[key] === "" ? null : data[key])
            );
            if (data.category && data.amount) {
                enableSubmit(true);
            } else {
                enableSubmit(false);
            }
            return data;
        }
        $("#category").on("change", collectData);
        $("#amount").on("change", collectData);

        const mainButton = window.Telegram.WebApp.MainButton;
        mainButton.text = "Опубликовать";
        mainButton.enable();
        mainButton.onClick(function () {
            window.Telegram.WebApp.sendData(JSON.stringify(collectData()));
        });

        function enableSubmit(activate) {
            if (activate) {
                mainButton.show();
            } else {
                mainButton.hide();
            }
        }
    });
</script>

</html>